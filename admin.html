<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ScanWarp Admin - Waitlist</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      padding: 2rem;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 2rem;
    }

    h1 {
      margin-bottom: 0.5rem;
      color: #333;
    }

    .stats {
      display: flex;
      gap: 2rem;
      margin: 2rem 0;
    }

    .stat-card {
      background: #f9f9f9;
      padding: 1.5rem;
      border-radius: 6px;
      flex: 1;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      color: #a44200;
    }

    .stat-label {
      color: #666;
      margin-top: 0.5rem;
    }

    .login-form {
      max-width: 400px;
      margin: 4rem auto;
    }

    .login-form input {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #ddd;
      border-radius: 6px;
      margin-bottom: 1rem;
      font-size: 1rem;
    }

    .login-form button {
      width: 100%;
      padding: 0.75rem;
      background: #a44200;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
    }

    .login-form button:hover {
      background: #8a3700;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 2rem;
    }

    th, td {
      text-align: left;
      padding: 1rem;
      border-bottom: 1px solid #eee;
    }

    th {
      background: #f9f9f9;
      font-weight: 600;
      color: #333;
    }

    .error {
      background: #fee;
      color: #c33;
      padding: 1rem;
      border-radius: 6px;
      margin: 1rem 0;
    }

    .export-btn {
      padding: 0.5rem 1rem;
      background: #2c701d;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1rem;
    }

    .export-btn:hover {
      background: #245a17;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ScanWarp Admin</h1>

    <div id="login-section">
      <div class="login-form">
        <h2>Login</h2>
        <input type="password" id="api-token" placeholder="Enter API token" />
        <button onclick="login()">Login</button>
        <div id="login-error" class="error hidden"></div>
      </div>
    </div>

    <div id="admin-section" class="hidden">
      <p style="color: #666;">Waitlist submissions for ScanWarp Cloud</p>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-number" id="total-count">0</div>
          <div class="stat-label">Total Signups</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="today-count">0</div>
          <div class="stat-label">Today</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="week-count">0</div>
          <div class="stat-label">This Week</div>
        </div>
      </div>

      <button class="export-btn" onclick="exportCSV()">Export as CSV</button>

      <table>
        <thead>
          <tr>
            <th>Email</th>
            <th>Signed Up</th>
          </tr>
        </thead>
        <tbody id="waitlist-table">
        </tbody>
      </table>
    </div>
  </div>

  <script>
    let apiToken = '';
    let waitlistData = [];

    function login() {
      apiToken = document.getElementById('api-token').value;
      if (!apiToken) {
        showError('Please enter an API token');
        return;
      }

      loadWaitlist();
    }

    async function loadWaitlist() {
      try {
        const response = await fetch('https://api.scanwarp.com/waitlist', {
          headers: {
            'Authorization': `Bearer ${apiToken}`
          }
        });

        if (!response.ok) {
          if (response.status === 401) {
            showError('Invalid API token');
            return;
          }
          throw new Error('Failed to load waitlist');
        }

        const data = await response.json();
        waitlistData = data.entries;

        document.getElementById('login-section').classList.add('hidden');
        document.getElementById('admin-section').classList.remove('hidden');

        renderWaitlist();
        updateStats();
      } catch (err) {
        showError('Failed to load waitlist: ' + err.message);
      }
    }

    function renderWaitlist() {
      const tbody = document.getElementById('waitlist-table');
      tbody.innerHTML = '';

      waitlistData.forEach(entry => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${entry.email}</td>
          <td>${formatDate(entry.created_at)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function updateStats() {
      const total = waitlistData.length;
      document.getElementById('total-count').textContent = total;

      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const todayCount = waitlistData.filter(e =>
        new Date(e.created_at) >= today
      ).length;
      document.getElementById('today-count').textContent = todayCount;

      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      const weekCount = waitlistData.filter(e =>
        new Date(e.created_at) >= weekAgo
      ).length;
      document.getElementById('week-count').textContent = weekCount;
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
    }

    function showError(message) {
      const errorEl = document.getElementById('login-error');
      errorEl.textContent = message;
      errorEl.classList.remove('hidden');
    }

    function exportCSV() {
      const csv = [
        ['Email', 'Signed Up'],
        ...waitlistData.map(e => [e.email, new Date(e.created_at).toISOString()])
      ].map(row => row.join(',')).join('\n');

      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `scanwarp-waitlist-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
    }
  </script>
</body>
</html>
